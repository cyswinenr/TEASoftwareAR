# Teacher Server 打包和安装指南

## 方案一：使用 PyInstaller 打包成可执行文件（推荐）

### 步骤 1：安装 PyInstaller

```bash
pip install pyinstaller
```

### 步骤 2：打包应用

在 `teacher_server` 目录下执行：

**方法 A：使用 spec 文件（推荐）**
```bash
pyinstaller build.spec
```

**方法 B：使用 Python 脚本**
```bash
python build_exe.py
```

**方法 C：直接使用 PyInstaller 命令**
```bash
pyinstaller --onefile --console --name=TeacherServer --add-data "app;app" --add-data "config.py;." --add-data "init_db.py;." run.py
```

### 步骤 3：打包结果

打包完成后，会在 `dist` 目录下生成 `TeacherServer.exe` 文件。

### 步骤 4：创建安装包

将以下文件复制到一个新文件夹（例如 `TeacherServer_安装包`）：

```
TeacherServer_安装包/
├── TeacherServer.exe          # 主程序
├── init_db.exe                # 数据库初始化程序（可选，或提供脚本）
├── 安装说明.txt               # 安装说明
├── 启动服务器.bat             # 启动脚本
└── 初始化数据库.bat           # 数据库初始化脚本
```

## 方案二：创建便携式安装包（无需安装 Python）

### 步骤 1：准备文件

创建一个文件夹，包含以下内容：

```
TeacherServer_便携版/
├── TeacherServer.exe          # 打包好的可执行文件
├── config.py                  # 配置文件（如果需要修改）
├── 启动服务器.bat
├── 初始化数据库.bat
└── 安装说明.txt
```

### 步骤 2：创建启动脚本

创建 `启动服务器.bat`：

```batch
@echo off
chcp 65001 >nul
echo 正在启动教师端服务器...
echo.
TeacherServer.exe
pause
```

### 步骤 3：创建初始化脚本

创建 `初始化数据库.bat`：

```batch
@echo off
chcp 65001 >nul
echo 正在初始化数据库...
echo.
python init_db.py
pause
```

## 方案三：使用安装程序打包（Inno Setup）

如果需要创建专业的 Windows 安装程序，可以使用 Inno Setup。

### 步骤 1：下载 Inno Setup

从 https://jrsoftware.org/isinfo.php 下载并安装 Inno Setup。

### 步骤 2：创建安装脚本

创建 `setup.iss` 文件（见下方示例）。

### 步骤 3：编译安装程序

在 Inno Setup 中打开 `setup.iss` 并编译。

## 安装到目标电脑

### 方法 1：直接复制（最简单）

1. 将打包好的 `TeacherServer.exe` 复制到目标电脑
2. 创建必要的目录结构：
   - `uploads/photos/` - 用于存储上传的照片
   - `logs/` - 用于存储日志文件
3. 首次运行前，执行数据库初始化（如果有 `init_db.exe`）
4. 双击 `TeacherServer.exe` 启动服务器

### 方法 2：使用安装脚本

1. 将整个安装包文件夹复制到目标电脑
2. 运行 `初始化数据库.bat`（首次安装）
3. 运行 `启动服务器.bat` 启动服务

### 方法 3：使用安装程序

1. 运行 `TeacherServer_Setup.exe`
2. 按照安装向导完成安装
3. 从开始菜单启动应用

## 注意事项

1. **数据库文件**：首次运行会自动创建 `tea_culture.db` 数据库文件
2. **端口占用**：确保目标电脑的 8888 端口未被占用
3. **防火墙**：如果需要在其他设备访问，需要在防火墙中允许 8888 端口
4. **依赖库**：如果使用 PyInstaller 打包，通常不需要额外安装 Python 和依赖库
5. **文件权限**：确保程序有权限在运行目录创建数据库和日志文件

## 测试安装

安装完成后，在浏览器中访问：
- http://localhost:8888

如果能看到网页界面，说明安装成功。

## 常见问题

### Q: 打包后的程序无法启动？
A: 检查是否有杀毒软件拦截，或者尝试使用 `--console` 参数查看错误信息。

### Q: 如何修改配置？
A: 可以编辑 `config.py` 文件，或者使用环境变量。

### Q: 数据库文件在哪里？
A: 数据库文件 `tea_culture.db` 会在程序运行目录下自动创建。

### Q: 如何更新程序？
A: 替换 `TeacherServer.exe` 文件即可，数据库文件会保留。

