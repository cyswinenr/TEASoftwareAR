{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2>学生列表</h2>
    
    <!-- 筛选表单 -->
    <form method="GET" style="margin-top: 20px;">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div class="form-group">
                <label>学校</label>
                <input type="text" name="school" value="{{ school }}" placeholder="输入学校名称">
            </div>
            <div class="form-group">
                <label>年级</label>
                <select name="grade">
                    <option value="">全部</option>
                    <option value="高一" {% if grade == '高一' %}selected{% endif %}>高一</option>
                    <option value="高二" {% if grade == '高二' %}selected{% endif %}>高二</option>
                </select>
            </div>
            <div class="form-group">
                <label>班级</label>
                <input type="text" name="class_number" value="{{ class_number }}" placeholder="输入班级号">
            </div>
            <div class="form-group" style="display: flex; align-items: flex-end;">
                <button type="submit" class="btn">筛选</button>
                <a href="/" class="btn btn-secondary" style="margin-left: 10px;">重置</a>
            </div>
        </div>
    </form>
</div>

<div class="card">
    <table class="table">
        <thead>
            <tr>
                <th>提交ID</th>
                <th>学校</th>
                <th>年级</th>
                <th>班级</th>
                <th>活动日期</th>
                <th>成员人数</th>
                <th>提交时间</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
            <tr>
                <td>{{ student.submission_id }}</td>
                <td>{{ student.school }}</td>
                <td>{{ student.grade }}</td>
                <td>{{ student.class_number }}班</td>
                <td>{{ student.activity_date }}</td>
                <td>{{ student.member_count }}人</td>
                <td>{{ student.submit_time.strftime('%Y-%m-%d %H:%M') if student.submit_time else '' }}</td>
                <td>
                    <a href="/student/{{ student.submission_id }}" class="btn btn-secondary" style="padding: 6px 12px; font-size: 14px;">查看详情</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="8" style="text-align: center; padding: 40px;">
                    暂无数据
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- 分页 -->
    {% if pagination.pages > 1 %}
    <div class="pagination">
        {% if pagination.has_prev %}
        <a href="?page={{ pagination.prev_num }}{% if school %}&school={{ school }}{% endif %}{% if grade %}&grade={{ grade }}{% endif %}{% if class_number %}&class_number={{ class_number }}{% endif %}">上一页</a>
        {% endif %}
        
        {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page_num %}
                {% if page_num == pagination.page %}
                <span class="current">{{ page_num }}</span>
                {% else %}
                <a href="?page={{ page_num }}{% if school %}&school={{ school }}{% endif %}{% if grade %}&grade={{ grade }}{% endif %}{% if class_number %}&class_number={{ class_number }}{% endif %}">{{ page_num }}</a>
                {% endif %}
            {% else %}
                <span>...</span>
            {% endif %}
        {% endfor %}
        
        {% if pagination.has_next %}
        <a href="?page={{ pagination.next_num }}{% if school %}&school={{ school }}{% endif %}{% if grade %}&grade={{ grade }}{% endif %}{% if class_number %}&class_number={{ class_number }}{% endif %}">下一页</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

