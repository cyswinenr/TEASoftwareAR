# 数据导出功能使用说明 📊

## 🎯 功能介绍

教师端新增了强大的数据导出功能，支持将学生提交的所有数据导出为Excel或JSON格式，方便统计分析和AI处理。

---

## 📦 安装依赖

### 方法1：使用批处理文件（推荐）
双击运行：`安装导出依赖.bat`

### 方法2：手动安装
```bash
pip install openpyxl==3.1.2
```

---

## 📊 导出格式对比

| 格式 | 适合场景 | 人类可读性 | AI分析 | 统计分析 |
|------|---------|-----------|--------|---------|
| **Excel** | 教师查看、统计分析、打印 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **JSON** | AI分析、程序处理 | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |

---

## 📁 Excel导出内容

导出的Excel文件包含6个工作表：

### 1️⃣ 数据统计摘要（首页）
- 导出时间、数据总数
- 按班级统计（提交组数、任务完成情况、平均提问数）

### 2️⃣ 学生基本信息
- 小组编号、学校、年级、班级
- 活动日期、成员人数、成员姓名
- 提交时间
- 各任务完成情况（✓/✗）
- 茶助教提问数

### 3️⃣ 任务一-泡茶体验
- 茶品信息（茶品名、茶类、水温、冲泡时长）
- 感官记录表格（干茶、茶汤、叶底的色泽/香气/形状/滋味）
- 思考题答案及字数统计

### 4️⃣ 任务二-泡出心中茶
- 茶品信息（茶品名、水温、出汤时长）
- 茶汤特点（色泽、香气、滋味）
- 是否符合预期
- 思考题答案及字数统计

### 5️⃣ 思考题
- 思考题一、二、创意题的答案
- 各题字数统计、总字数

### 6️⃣ 茶助教问答记录（紫色主题）
- 完整对话记录（小组、对话序号、角色、内容）
- 支持按班级、角色筛选分析
- 适合统计学生提问类型、AI回答质量

---

## 🚀 使用方法

### 1. 在教师端首页

1. **登录教师端** → 打开浏览器访问服务器地址
2. **设置筛选条件**（可选）
   - 学校
   - 年级
   - 班级
   - 日期范围
3. **点击导出按钮**
   - 📊 **导出Excel**（推荐）→ 下载包含6个工作表的Excel文件
   - 📄 **导出JSON**（AI分析）→ 下载结构化JSON文件

### 2. 导出的数据范围

- 如果设置了筛选条件，只导出符合条件的数据
- 如果没有筛选，导出全部数据
- 导出按钮下方会显示"共 X 条记录"

---

## 📈 使用Excel进行数据分析

### 基础分析
1. **打开Excel文件** → 查看各个工作表
2. **筛选排序** → 使用Excel的筛选功能
3. **统计计算** → 使用SUM、AVERAGE等函数
4. **创建图表** → 插入柱状图、饼图等

### 高级分析示例

#### 1. 统计学生提问热点话题
在"茶助教问答记录"工作表：
- 筛选"角色"列为"学生"
- 查看"消息内容"列
- 使用文本分析工具统计关键词

#### 2. 分析任务完成度
在"学生基本信息"工作表：
- 使用COUNTIF统计完成"是"的数量
- 计算完成率 = 完成数/总数 × 100%

#### 3. 对比不同班级表现
在"数据统计摘要"工作表：
- 查看各班级统计数据
- 创建柱状图对比

---

## 🤖 给AI分析（JSON格式）

### 数据结构
```json
{
  "export_time": "2025-12-31T10:00:00",
  "total_groups": 50,
  "groups": [
    {
      "group_info": {
        "group_number": 1,
        "school": "示例中学",
        "grade": "高二",
        "class_number": "5",
        "members": ["张三", "李四"]
      },
      "chat_messages": [
        {
          "index": 0,
          "role": "user",
          "content": "茶叶有哪些种类？"
        },
        {
          "index": 1,
          "role": "assistant",
          "content": "茶叶主要分为六大类..."
        }
      ],
      "statistics": {
        "student_questions": 5,
        "ai_responses": 5
      }
    }
  ]
}
```

### Python分析示例
```python
import json
import pandas as pd

# 读取JSON
with open('data.json', 'r', encoding='utf-8') as f:
    data = json.load(f)

# 提取所有学生提问
questions = []
for group in data['groups']:
    for msg in group['chat_messages']:
        if msg['role'] == 'user':
            questions.append({
                'school': group['group_info']['school'],
                'grade': group['group_info']['grade'],
                'class': group['group_info']['class_number'],
                'question': msg['content']
            })

df = pd.DataFrame(questions)
print(f"总提问数：{len(df)}")
print(df.head())
```

---

## 💡 应用场景

### 教学评估
- 统计学生完成情况
- 分析学生答题质量
- 评估不同班级表现

### 教研分析
- 分析学生常见问题
- 评估茶助教回答质量
- 改进课程设计

### AI深度分析
- 学生提问模式分析
- 知识点掌握情况分析
- 个性化学习建议生成

---

## ⚠️ 注意事项

1. **数据安全**
   - 导出的文件包含学生信息，请妥善保管
   - 不要将文件上传到公共网站

2. **文件命名**
   - 文件名自动包含时间戳
   - 如果设置了筛选条件，文件名会包含筛选信息
   - 例如：`茶文化课程数据_示例中学_高二_5班_20251231_103000.xlsx`

3. **大量数据**
   - 如果数据量很大（>1000条），导出可能需要几秒钟
   - Excel文件建议不超过10000条记录
   - 超大数据建议使用JSON格式

---

## 🔧 故障排除

### Q1: 点击导出按钮没有反应？
**A:** 
1. 检查是否安装了openpyxl：`pip list | grep openpyxl`
2. 查看服务器日志是否有错误信息
3. 尝试重启服务器

### Q2: 导出的Excel文件打不开？
**A:**
1. 确认Excel版本（需要2007或更高版本）
2. 尝试用WPS打开
3. 检查文件是否完整下载（查看文件大小）

### Q3: 导出时显示"没有数据可导出"？
**A:**
1. 检查数据库是否有数据
2. 检查筛选条件是否过于严格
3. 尝试重置筛选条件

### Q4: 导出的数据不完整？
**A:**
1. 检查筛选条件设置
2. 确认学生是否提交了所有数据
3. 查看"数据统计摘要"工作表的记录总数

---

## 📞 技术支持

如有其他问题，请联系技术支持团队。

**祝使用愉快！** 🎉

