# 教师端服务器 - 部署指南

## 场景：在没有安装 Python 的电脑上运行

### 方法一：使用打包好的可执行文件（推荐）

#### 步骤 1：在当前电脑上打包

1. **确保当前电脑已安装 Python**
   - Python 3.8 或更高版本
   - 已安装所有依赖包

2. **执行打包**

   **方法 A：使用一键打包脚本（最简单）**
   ```bash
   # 双击运行
   一键打包.bat
   ```

   **方法 B：手动打包**
   ```bash
   # 1. 安装 PyInstaller
   pip install pyinstaller
   
   # 2. 进入 teacher_server 目录
   cd teacher_server
   
   # 3. 执行打包
   pyinstaller build.spec
   ```

3. **打包结果**
   - 打包完成后，在 `dist` 目录下会生成 `TeacherServer.exe`
   - 这个文件包含了所有依赖，可以在没有 Python 的电脑上运行

#### 步骤 2：准备部署包

创建一个文件夹，包含以下文件：

```
TeacherServer_部署包/
├── TeacherServer.exe          # 主程序（从 dist 目录复制）
├── 启动服务器.bat              # 启动脚本
├── 安装说明.txt                # 用户说明文档
└── README.txt                  # 快速开始指南（可选）
```

#### 步骤 3：复制到目标电脑

1. 将整个 `TeacherServer_部署包` 文件夹复制到目标电脑
2. 可以放在任意位置，例如：
   - `C:\TeacherServer\`
   - `D:\Programs\TeacherServer\`
   - 桌面上的文件夹

#### 步骤 4：在目标电脑上运行

1. **首次运行**
   - 双击 `启动服务器.bat` 或直接运行 `TeacherServer.exe`
   - 程序会自动创建数据库和必要的目录

2. **访问服务器**
   - 打开浏览器
   - 访问：`http://localhost:8888`

3. **停止服务器**
   - 在控制台窗口中按 `Ctrl+C`
   - 或直接关闭控制台窗口

---

## 方法二：便携式部署（无需安装）

### 完整部署包结构

```
TeacherServer_完整版/
├── TeacherServer.exe          # 主程序
├── 启动服务器.bat              # 启动脚本
├── 安装说明.txt                # 安装说明
├── README.txt                  # 使用说明
└── [自动生成的目录]
    ├── uploads/               # 照片上传目录（自动创建）
    │   └── photos/
    ├── logs/                  # 日志目录（自动创建）
    │   └── app.log
    └── tea_culture.db         # 数据库文件（自动创建）
```

### 使用说明

1. **解压到任意位置**
   - 不需要安装，不需要管理员权限
   - 建议放在非系统盘（如 D 盘）

2. **运行程序**
   - 双击 `启动服务器.bat`
   - 或直接运行 `TeacherServer.exe`

3. **数据存储**
   - 所有数据（数据库、照片、日志）都存储在程序运行目录
   - 备份数据：复制整个文件夹即可

---

## 常见问题

### Q1: 打包后的 .exe 文件被杀毒软件拦截？

**A:** 这是正常现象，PyInstaller 打包的文件经常被误报。解决方法：
- 添加到杀毒软件白名单
- 或使用 Windows Defender 排除该文件夹

### Q2: 程序无法启动？

**A:** 检查以下几点：
1. 确保 8888 端口未被占用
2. 检查防火墙设置
3. 查看控制台错误信息
4. 确保有写入权限（程序需要创建数据库和日志文件）

### Q3: 如何修改端口？

**A:** 需要重新打包，或使用配置文件（如果支持）

### Q4: 如何备份数据？

**A:** 复制以下文件/目录：
- `tea_culture.db` - 数据库文件
- `uploads/photos/` - 照片目录
- `logs/` - 日志目录（可选）

### Q5: 如何更新程序？

**A:** 
1. 停止旧程序
2. 替换 `TeacherServer.exe` 文件
3. 数据库文件会自动保留

### Q6: 可以在多台电脑上使用同一个 .exe 吗？

**A:** 可以！打包后的 .exe 文件可以在任何 Windows 电脑上运行，不需要安装 Python。

---

## 系统要求

- **操作系统**: Windows 7 或更高版本（64位）
- **内存**: 至少 512MB 可用内存
- **磁盘空间**: 至少 100MB 可用空间
- **网络**: 不需要（本地运行）或需要（远程访问）

---

## 高级配置

### 作为 Windows 服务运行（可选）

如果需要开机自启动或后台运行，可以使用 NSSM（Non-Sucking Service Manager）：

1. 下载 NSSM: https://nssm.cc/download
2. 安装服务：
   ```bash
   nssm install TeacherServer "C:\TeacherServer\TeacherServer.exe"
   ```
3. 启动服务：
   ```bash
   nssm start TeacherServer
   ```

### 防火墙配置

如果需要在其他设备访问服务器：

1. 打开 Windows 防火墙
2. 添加入站规则
3. 允许 8888 端口的 TCP 连接

---

## 技术支持

如有问题，请查看：
- `logs/app.log` - 应用日志
- 控制台输出 - 错误信息

